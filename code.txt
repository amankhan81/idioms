<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100 Idioms for IGCSE English 0510</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Fonts: Kalam (Handwriting), Nunito (Meanings), Graduate (Title), and Inter (Idiom Entry Text) -->
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&family=Nunito:wght@400;600;700&family=Graduate&family=Inter:wght@600;700;900&display=swap" rel="stylesheet">
    <style>
        /* Custom CSS */
        .handwriting {
            font-family: 'Kalam', cursive;
            font-size: 1.125rem; /* text-lg */
            color: #000;
        }
        
        /* Idiom text style (within card header - now using Inter for Aptos feel and reduced size) */
        .idiom-title {
            font-family: 'Inter', sans-serif; /* Using Inter for Aptos/clean sans-serif feel */
            font-size: 1.1rem; /* Slightly smaller than before (1.25rem) */
            color: #1e40af; /* Dark blue for strong contrast */
            font-weight: 700;
            /* Subtle 3D text shadow */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2), 0 0 1px #ffffff;
        }
        
        /* Style for highlighted idiom inside the example sentence (RED, BOLD, KALAM FONT) */
        .example-highlight {
            font-family: 'Kalam', cursive; /* Match surrounding handwriting font */
            font-size: 1.125rem; /* Match surrounding handwriting size */
            color: #dc2626; /* RED color */
            font-weight: 700; /* Bold */
            text-shadow: none; /* Remove subtle text-shadow for clarity */
        }
        
        /* Style for Meanings: Dark Green and Nunito Font */
        .idiom-meaning {
            font-family: 'Nunito', sans-serif;
            color: #15803d; /* Dark Green (green-700) */
            font-weight: 600;
            font-size: 1rem;
        }
        /* Stylish Title Font: Graduate, Red, Bold */
        .main-title {
            font-family: 'Graduate', cursive;
            color: #dc2626; /* Red-600 */
            font-weight: 700;
        }
        .speaker-btn {
            background-color: transparent;
            border: none;
            color: #10b981; /* Tailwind emerald-500 */
            cursor: pointer;
            padding: 0;
            margin-left: 0.5rem;
            transition: transform 0.1s;
        }
        .speaker-btn:hover {
            transform: scale(1.1);
            color: #059669;
        }

        /* --- REDESIGNED CARD STYLES (3D / Neumorphic Look) --- */
        
        /* Themed Background Gradients */
        .theme-1 { background: linear-gradient(145deg, #f0f9ff, #e0f2fe); border-color: #dbeafe; } /* Light Blue */
        .theme-2 { background: linear-gradient(145deg, #f0fff4, #d1fae5); border-color: #a7f3d0; } /* Light Green */
        .theme-3 { background: linear-gradient(145deg, #fff7ed, #ffedd5); border-color: #fed7aa; } /* Light Peach */
        .theme-4 { background: linear-gradient(145deg, #f5f3ff, #ede9fe); border-color: #ddd6fe; } /* Light Purple */

        .idiom-card {
            border: 1px solid #dbeafe;
            box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.1), -4px -4px 8px rgba(255, 255, 255, 0.5);
            transition: all 0.3s ease;
        }
        .idiom-card:hover {
            transform: translateY(-2px);
            box-shadow: 10px 10px 20px rgba(0, 0, 0, 0.15), -5px -5px 10px rgba(255, 255, 255, 0.8);
        }
        .idiom-id {
            color: #1e40af; /* Darker blue number */
            font-weight: 800;
        }
        /* --- QUIZ STYLES --- */
        .quiz-option {
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            box-shadow: 3px 3px 6px rgba(0, 0, 0, 0.1), -2px -2px 4px rgba(255, 255, 255, 0.8);
            transition: all 0.2s ease;
        }
        .quiz-option:hover:not([disabled]) {
            transform: translateY(-1px);
            background: linear-gradient(145deg, #e0f2fe, #f0f9ff);
        }
        
        /* Feedback Styles */
        .correct-answer {
            background: linear-gradient(145deg, #d1fae5, #ecfdf5); 
            border-color: #10b981; 
            box-shadow: 0 0 10px #10b981; 
            animation: pulse-correct 0.3s;
        }
        .incorrect-answer {
            background: linear-gradient(145deg, #fee2e2, #fef2f2); 
            border-color: #f87171; 
            box-shadow: 0 0 10px #f87171;
            animation: shake 0.3s;
        }

        /* Keyframes for dramatic feedback */
        @keyframes pulse-correct {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col font-sans" onload="initializeApp()">

    <!-- New Full-Width Blue Header -->
    <div class="w-full bg-blue-600 text-white py-4 text-center font-bold text-xl shadow-md">
        Created by Amanullah Khan
    </div>

    <!-- Main Content Wrapper with Padding -->
    <main class="flex-grow p-4 sm:p-8">
        <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-xl p-6 sm:p-10">
            
            <header class="text-center mb-10 border-b-4 border-blue-500 pb-4">
                <h1 class="main-title text-2xl sm:text-3xl md:text-4xl mb-2">
                    100 Idioms for IGCSE English 0510
                </h1>
                <p class="text-lg text-gray-500 mt-2">
                    Vocabulary Study & Practice Test
                </p>
            </header>

            <!-- Quiz Script and Data -->
            <script>
                // Global initialization function to run on body load
                function initializeApp() {
                    renderIdiomList();
                }

                // Variable to hold the currently playing audio element
                let currentAudio = null;
                const FEEDBACK_DELAY_MS = 1500; // Time to show feedback before next question
                const CARD_THEMES = ['theme-1', 'theme-2', 'theme-3', 'theme-4'];

                // --- MASTER LIST OF 100 IDIOMS (Apostrophes removed) ---
                const ALL_IDIOMS_DATA = [
                    { id: 1, idiom: "Over the moon", emoji: "ðŸ˜Š", meaning: "Extremely happy and delighted.", example: "I was __ when I heard I got the concert tickets!", correctWord: "over the moon" },
                    { id: 2, idiom: "A piece of cake", emoji: "ðŸ°", meaning: "Something very easy to do.", example: "Don't worry about the history test, it'll be __ for you.", correctWord: "a piece of cake" },
                    { id: 3, idiom: "Take a rain check", emoji: "â˜”", meaning: "To politely decline an invitation, but offer to do it later.", example: "I can't make it to the party tonight, but can I __ for next time?", correctWord: "take a rain check" },
                    { id: 4, idiom: "Let the cat out of the bag", emoji: "ðŸˆ", meaning: "To accidentally reveal a secret.", example: "Oops! I think I __ about your surprise party.", correctWord: "let the cat out of the bag" },
                    { id: 5, idiom: "Speak of the devil", emoji: "ðŸ—£ï¸", meaning: "Said when the person you were just talking about unexpectedly appears.", example: "__, Jane just walked into the room!", correctWord: "Speak of the devil" },
                    { id: 6, idiom: "Every cloud has a silver lining", emoji: "â˜ï¸", meaning: "Be optimistic; difficult times will lead to better days.", example: "I know failing the exam was tough, but remember, __.", correctWord: "every cloud has a silver lining" },
                    { id: 7, idiom: "Under the weather", emoji: "ðŸ¤•", meaning: "Slightly ill or unwell.", example: "I'm feeling a bit __ today, so I'll stay home from school.", correctWord: "under the weather" },
                    { id: 8, idiom: "Cut a long story short", emoji: "âœ‚ï¸", meaning: "To tell the main points and omit unnecessary details.", example: "To __, we missed the last train and had to walk home.", correctWord: "cut a long story short" },
                    { id: 9, idiom: "See eye to eye", emoji: "ðŸ‘€", meaning: "To agree completely with someone.", example: "Luckily, my study partner and I __ on how to plan our project.", correctWord: "see eye to eye" },
                    { id: 10, idiom: "Back to the drawing board", emoji: "âœï¸", meaning: "To start over after a plan or idea has failed.", example: "The experiment failed, so it's __ for our science group.", correctWord: "back to the drawing board" },
                    { id: 11, idiom: "The ball is in your court", emoji: "ðŸ€", meaning: "It is up to you to make the next decision or step.", example: "I've given you my advice; now __ to decide.", correctWord: "the ball is in your court" },
                    { id: 12, idiom: "Cost an arm and a leg", emoji: "ðŸ’°", meaning: "To be very expensive.", example: "Those new headphones must __!", correctWord: "cost an arm and a leg" },
                    { id: 13, idiom: "Go the extra mile", emoji: "ðŸ¥‡", meaning: "To make a special effort to achieve something.", example: "She always __ to help her younger sister with homework.", correctWord: "goes the extra mile" },
                    { id: 14, idiom: "Hit the nail on the head", emoji: "ðŸ“Œ", meaning: "To describe exactly what is causing a situation or problem.", example: "That's right, you __! I completely forgot about the deadline.", correctWord: "hit the nail on the head" },
                    { id: 15, idiom: "Bite the bullet", emoji: "ðŸ˜¬", meaning: "To face a difficult or unpleasant situation with courage.", example: "I don't want to tell my parents, but I have to __ and admit I lost the book.", correctWord: "bite the bullet" },
                    { id: 16, idiom: "Burn the midnight oil", emoji: "ðŸ“š", meaning: "To stay up late working or studying.", example: "We had to __ last night to finish the history presentation.", correctWord: "burn the midnight oil" },
                    { id: 17, idiom: "Call it a day", emoji: "â¸ï¸", meaning: "To stop working on something; to finish for the day.", example: "It's getting late. Let's __ and finish this tomorrow morning.", correctWord: "call it a day" },
                    { id: 18, idiom: "Hang in there", emoji: "ðŸ’ª", meaning: "Don't give up; persist (often used as encouragement).", example: "The training is tough, but __! You'll be great.", correctWord: "hang in there" },
                    { id: 19, idiom: "A blessing in disguise", emoji: "ðŸŽ", meaning: "Something that seems bad or unlucky at first but results in something good later on.", example: "Missing the early bus was __ because I got a better seat on the next one.", correctWord: "a blessing in disguise" },
                    { id: 20, idiom: "Keep an eye on", emoji: "ðŸ‘‚", meaning: "To watch or look after carefully.", example: "Can you __ my bag while I quickly get a drink?", correctWord: "keep an eye on" },
                    { id: 21, idiom: "Miss the boat", emoji: "ðŸš¢", meaning: "To miss an opportunity.", example: "The deadline for applications passed yesterday; I totally __.", correctWord: "missed the boat" },
                    { id: 22, idiom: "Get your act together", emoji: "ðŸ›‘", meaning: "To organize oneself and behave more effectively.", example: "You need to __ if you want to pass the final exams.", correctWord: "get your act together" },
                    { id: 23, idiom: "Give it a shot", emoji: "ðŸ‘", meaning: "To try something.", example: "I'm not sure if I can do it, but I'll __ anyway!", correctWord: "give it a shot" },
                    { id: 24, idiom: "Think outside the box", emoji: "ðŸ’¡", meaning: "To think creatively and unconventionally.", example: "For this project, we need to __ to come up with a truly unique idea.", correctWord: "think outside the box" },
                    { id: 25, idiom: "Once in a blue moon", emoji: "ðŸŒ™", meaning: "Very rarely.", example: "I only watch a movie with my parents __, so it's a special treat.", correctWord: "once in a blue moon" },
                    { id: 26, idiom: "Hit the sack", emoji: "ðŸ˜´", meaning: "To go to bed.", example: "I'm exhausted after that long trip, I need to __.", correctWord: "hit the sack" },
                    { id: 27, idiom: "The whole nine yards", emoji: "ðŸŽ¯", meaning: "Everything; all of it.", example: "For his birthday party, we got him a cake, presents, and balloons â€“ __.", correctWord: "the whole nine yards" },
                    { id: 28, idiom: "On the same page", emoji: "ðŸ¤", meaning: "To be in agreement about something.", example: "Let's quickly review the plan to make sure we're all __.", correctWord: "on the same page" },
                    { id: 29, idiom: "Couch potato", emoji: "ðŸ›‹ï¸", meaning: "A very lazy person who spends a lot of time watching TV.", example: "Don't be such a __ this weekend; let's go outside!", correctWord: "couch potato" },
                    { id: 30, idiom: "Wrap my head around", emoji: "ðŸ§ ", meaning: "To understand something complicated or strange.", example: "I'm finding it hard to __ the physics concepts we learned today.", correctWord: "wrap my head around" },
                    { id: 31, idiom: "Read between the lines", emoji: "ðŸ“˜", meaning: "To understand the hidden or implied meaning.", example: "She said she was 'fine', but if you __, you can tell she's upset.", correctWord: "read between the lines" },
                    { id: 32, idiom: "The icing on the cake", emoji: "ðŸ‘‘", meaning: "An extra benefit or positive element that makes a good situation even better.", example: "Getting the job offer was great, but the big salary increase was __.", correctWord: "the icing on the cake" },
                    { id: 33, idiom: "When pigs fly", emoji: "ðŸ·", meaning: "Something that will never happen.", example: "He'll apologize for what he did __!", correctWord: "when pigs fly" },
                    { id: 34, idiom: "Skating on thin ice", emoji: "ðŸ¥¶", meaning: "To be in a risky situation.", example: "If you keep skipping classes, you'll be __ with the principal.", correctWord: "skating on thin ice" },
                    { id: 35, idiom: "A drop in the ocean", emoji: "ðŸ’§", meaning: "A tiny amount compared to what is needed.", example: "The money we raised is just __ compared to the total needed for the project.", correctWord: "a drop in the ocean" },
                    { id: 36, idiom: "The apple of my eye", emoji: "ðŸŽ", meaning: "A person who is cherished above all others.", example: "My younger cousin is absolutely __.", correctWord: "the apple of my eye" },
                    { id: 37, idiom: "Catch up", emoji: "ðŸŽ‰", meaning: "To meet someone after a period of time to share news.", example: "I haven't seen you in ages! We must __ soon.", correctWord: "catch up" },
                    { id: 38, idiom: "Lend a hand", emoji: "ðŸ¤", meaning: "Help with something or assist someone.", example: "Can you __ with setting up the decorations for the party?", correctWord: "lend a hand" },
                    { id: 39, idiom: "Hold your horses", emoji: "ðŸ´", meaning: "Wait a moment or slow down.", example: "Just __ for a minute, I need to check the exact time of the meeting.", correctWord: "hold your horses" },
                    { id: 40, idiom: "A dime a dozen", emoji: "ðŸª™", meaning: "Very common and easily found.", example: "Good study guides are __ online, so don't pay too much for one.", correctWord: "a dime a dozen" },
                    { id: 41, idiom: "All ears", emoji: "ðŸ‘‚", meaning: "Eager and ready to listen.", example: "Tell me about your tripâ€”I'm __!", correctWord: "all ears" },
                    { id: 42, idiom: "Put all your eggs in one basket", emoji: "ðŸ¥š", meaning: "To risk everything on one venture.", example: "It's better to apply to a few universities and not __.", correctWord: "put all your eggs in one basket" },
                    { id: 43, idiom: "Jump on the bandwagon", emoji: "ðŸšŒ", meaning: "To join an activity or trend that has become popular.", example: "Everyone started wearing those shoes, so I decided to __ too.", correctWord: "jump on the bandwagon" },
                    { id: 44, idiom: "To make matters worse", emoji: "ðŸ“‰", meaning: "To make a bad situation even more difficult or unpleasant.", example: "First, I missed the bus, and then, __, it started raining heavily.", correctWord: "to make matters worse" },
                    { id: 45, idiom: "Give the benefit of the doubt", emoji: "â“", meaning: "To accept someone's statement or excuse as true, without proof.", example: "I'll __ and assume she just forgot to reply to the email.", correctWord: "give her the benefit of the doubt" },
                    { id: 46, idiom: "Head over heels", emoji: "ðŸ¤¸", meaning: "Madly in love or extremely enthusiastic about something.", example: "I am __ about the new concert venue; it looks amazing!", correctWord: "head over heels" },
                    { id: 47, idiom: "Through thick and thin", emoji: "ðŸ›¡ï¸", meaning: "Supporting someone unconditionally, especially during difficult times.", example: "Thanks for always sticking by me __; you're a great friend.", correctWord: "through thick and thin" },
                    { id: 48, idiom: "Take it easy", emoji: "ðŸ›€", meaning: "Relax; calm down.", example: "I'm going to __ this weekend after the exams.", correctWord: "take it easy" },
                    { id: 49, idiom: "Get over it", emoji: "ðŸ¤¸", meaning: "Recover from something upsetting.", example: "He was sad about the loss, but he needs to __ now.", correctWord: "get over it" },
                    { id: 50, idiom: "Ring a bell", emoji: "ðŸ””", meaning: "Sound familiar.", example: "That name doesn't __; I've never heard of him.", correctWord: "ring a bell" },
                    { id: 51, idiom: "Sleep on it", emoji: "ðŸ˜´", meaning: "Delay making a decision until the next day.", example: "It's a big choice, so why don't you __?", correctWord: "sleep on it" },
                    { id: 52, idiom: "On the dot", emoji: "ðŸ•›", meaning: "Exactly on time.", example: "Make sure you arrive at 12:00 __.", correctWord: "on the dot" },
                    { id: 53, idiom: "Easy come, easy go", emoji: "ðŸŒ¬ï¸", meaning: "Something acquired without effort is also easily lost.", example: "I lost the money I won, but hey, __.", correctWord: "easy come, easy go" },
                    { id: 54, idiom: "Get cold feet", emoji: "ðŸ§Š", meaning: "Become nervous or hesitant about something.", example: "He was planning to perform, but he __ at the last minute.", correctWord: "got cold feet" },
                    { id: 55, idiom: "Make ends meet", emoji: "ðŸ’µ", meaning: "Earn just enough money to live on.", example: "It's hard to __ with prices rising so fast.", correctWord: "make ends meet" },
                    { id: 56, idiom: "Once bitten, twice shy", emoji: "ðŸ", meaning: "After a bad experience, one is careful to avoid similar situations.", example: "I won't trust that website again; __.", correctWord: "once bitten, twice shy" },
                    { id: 57, idiom: "Keep your head above water", emoji: "ðŸŠ", meaning: "Managing to cope with a difficult situation, especially financial.", example: "I'm working two jobs just to __.", correctWord: "keep my head above water" },
                    { id: 58, idiom: "A storm in a teacup", emoji: "â˜•", meaning: "A lot of fuss about something unimportant.", example: "The argument over the seating plan was just __.", correctWord: "a storm in a teacup" },
                    { id: 59, idiom: "In a nutshell", emoji: "ðŸŒ°", meaning: "Summarized briefly.", example: "To put the complicated theory __, it was a disaster.", correctWord: "in a nutshell" },
                    { id: 60, idiom: "The last straw", emoji: "ðŸŒ¾", meaning: "The final irritation that causes someone to lose patience.", example: "When she was late again, that was __.", correctWord: "the last straw" },
                    { id: 61, idiom: "Pass with flying colours", emoji: "ðŸŒˆ", meaning: "Pass an exam or test easily and with high marks.", example: "I studied hard and managed to __.", correctWord: "pass with flying colours" },
                    { id: 62, idiom: "Get the hang of", emoji: "ðŸ‘Œ", meaning: "Learn how to do something, especially something new.", example: "It took me a week, but now I'm starting to __ playing the guitar.", correctWord: "get the hang of" },
                    { id: 63, idiom: "The bottom line", emoji: "ðŸ“", meaning: "The most important factor or result.", example: "__ is that we need to finish this report by Friday.", correctWord: "The bottom line" },
                    { id: 64, idiom: "Turn a blind eye", emoji: "ðŸ™ˆ", meaning: "To pretend not to notice something bad or illegal.", example: "The teacher chose to __ to the small whispering.", correctWord: "turn a blind eye" },
                    { id: 65, idiom: "Get the ball rolling", emoji: "âš½", meaning: "To start an activity or process.", example: "Let's __ and start planning our next holiday.", correctWord: "get the ball rolling" },
                    { id: 66, idiom: "By the skin of one's teeth", emoji: "ðŸ¦·", meaning: "Just barely succeeding in doing something.", example: "I passed the driving test only __.", correctWord: "by the skin of my teeth" },
                    { id: 67, idiom: "Give someone the cold shoulder", emoji: "ðŸ¥¶", meaning: "To intentionally ignore someone.", example: "I tried to talk to her, but she just __.", correctWord: "gave me the cold shoulder" },
                    { id: 68, idiom: "No pain, no gain", emoji: "ðŸ’ª", meaning: "Suffering is necessary to achieve success.", example: "You must practice every day; __!", correctWord: "no pain, no gain" },
                    { id: 69, idiom: "Jump the gun", emoji: "ðŸƒ", meaning: "To start doing something too soon or prematurely.", example: "We should wait for the official announcement and not __.", correctWord: "jump the gun" },
                    { id: 70, idiom: "Keep a straight face", emoji: "ðŸ˜", meaning: "To manage to look serious and avoid laughing.", example: "It was so funny, I couldn't __ during the presentation.", correctWord: "keep a straight face" },
                    { id: 71, idiom: "Let sleeping dogs lie", emoji: "ðŸ•", meaning: "To avoid bringing up a past problem or argument.", example: "Don't ask him about his old job; it's better to __.", correctWord: "let sleeping dogs lie" },
                    { id: 72, idiom: "Take the plunge", emoji: "ðŸ’§", meaning: "To finally commit to a risky or serious undertaking.", example: "After months of planning, I decided to __ and start my own club.", correctWord: "take the plunge" },
                    { id: 73, idiom: "Hit the books", emoji: "ðŸ“–", meaning: "To study hard, usually for a test or exam.", example: "I need to __ tonight if I want to pass the maths test.", correctWord: "hit the books" },
                    { id: 74, idiom: "Run out of steam", emoji: "ðŸ’¨", meaning: "To lose momentum or energy.", example: "He started the marathon strong but quickly __ halfway through.", correctWord: "ran out of steam" },
                    { id: 75, idiom: "Put your feet up", emoji: "ðŸ–ï¸", meaning: "To relax, take a break.", example: "I'm looking forward to getting home and __ for the evening.", correctWord: "putting my feet up" },
                    { id: 76, idiom: "Get something out of your system", emoji: "ðŸŒ¬ï¸", meaning: "To do something you've wanted to do so you can move on.", example: "You should take that holiday to __ before you start university.", correctWord: "get it out of your system" },
                    { id: 77, idiom: "Two sides of the same coin", emoji: "ðŸª™", meaning: "Two different aspects of the same situation.", example: "Their honesty and bluntness are just __.", correctWord: "two sides of the same coin" },
                    { id: 78, idiom: "Break a leg", emoji: "ðŸ¤ž", meaning: "Good luck (used especially to wish success to a performer).", example: "Tell him to __ before he goes on stage!", correctWord: "break a leg" },
                    { id: 79, idiom: "Against the clock", emoji: "â±ï¸", meaning: "Rushing to meet a tight deadline.", example: "We worked __ to get the newspaper printed before morning.", correctWord: "against the clock" },
                    { id: 80, idiom: "Get down to brass tacks", emoji: "ðŸ› ï¸", meaning: "Start discussing the essential, fundamental details.", example: "Enough small talk, let's __ and discuss the budget.", correctWord: "get down to brass tacks" },
                    { id: 81, idiom: "Add insult to injury", emoji: "ðŸ©¹", meaning: "To make a bad situation worse.", example: "Not only did they lose the match, but to __, they had to pay a fine.", correctWord: "add insult to injury" },
                    { id: 82, idiom: "Pull yourself together", emoji: "ðŸ§˜", meaning: "Recover control of one's emotions.", example: "You need to __ and focus on the presentation.", correctWord: "pull yourself together" },
                    { id: 83, idiom: "Take a deep breath", emoji: "ðŸ˜®â€ðŸ’¨", meaning: "Pause to calm down before continuing.", example: "Just __ and start your speech when you feel ready.", correctWord: "take a deep breath" },
                    { id: 84, idiom: "Come hell or high water", emoji: "ðŸŒŠ", meaning: "No matter what difficulties arise.", example: "We will finish this project by the deadline, __.", correctWord: "come hell or high water" },
                    { id: 85, idiom: "Give and take", emoji: "ðŸ¤²", meaning: "Compromise between opposing positions.", example: "A good friendship requires a lot of __.", correctWord: "give and take" },
                    { id: 86, idiom: "Keep your shirt on", emoji: "ðŸ‘š", meaning: "Remain calm; don't get angry.", example: "__, I'll be there in five minutes!", correctWord: "Keep your shirt on" },
                    { id: 87, idiom: "Up in the air", emoji: "ðŸª", meaning: "Uncertain or undecided.", example: "Our travel plans for next summer are still __.", correctWord: "up in the air" },
                    { id: 88, idiom: "Spill the beans", emoji: "ðŸ²", meaning: "Reveal a secret.", example: "Come on, don't keep me waitingâ€”__ about your new job!", correctWord: "spill the beans" },
                    { id: 89, idiom: "Be on cloud nine", emoji: "â˜ï¸", meaning: "Be extremely happy.", example: "She has been __ since she got into her dream university.", correctWord: "on cloud nine" },
                    { id: 90, idiom: "Walk on air", emoji: "ðŸŽˆ", meaning: "Be extremely happy or excited.", example: "He was practically __ after his successful performance.", correctWord: "walking on air" },
                    { id: 91, idiom: "A red letter day", emoji: "ðŸ“…", meaning: "A significant, memorable, or joyful day.", example: "My graduation day was truly __ for my whole family.", correctWord: "a red letter day" },
                    { id: 92, idiom: "To each their own", emoji: "ðŸ¤·", meaning: "Everyone has their own preferences.", example: "I wouldn't choose that colour, but __.", correctWord: "to each their own" },
                    { id: 93, idiom: "Better safe than sorry", emoji: "â›‘ï¸", meaning: "It is better to take precautions than to regret the consequences.", example: "Put on sunscreen, just to be on the safe sideâ€”__.", correctWord: "better safe than sorry" },
                    { id: 94, idiom: "Time flies", emoji: "â³", meaning: "Time passes quickly.", example: "I can't believe the holidays are over already; __!", correctWord: "time flies" },
                    
                    // --- 6 NEW IDIOMS TO MAKE 100 ---
                    { id: 95, idiom: "Get a kick out of", emoji: "ðŸ’¥", meaning: "To enjoy doing something very much.", example: "I really __ watching old cartoons.", correctWord: "get a kick out of" },
                    { id: 96, idiom: "Take five", emoji: "â¸ï¸", meaning: "To take a short break.", example: "We've been studying for two hours, let's __.", correctWord: "take five" },
                    { id: 97, idiom: "Get the picture", emoji: "ðŸ–¼ï¸", meaning: "To understand the situation.", example: "I explained it slowly so she could __.", correctWord: "get the picture" },
                    { id: 98, idiom: "Speak your mind", emoji: "ðŸ’¬", meaning: "To say exactly what you think.", example: "She's not afraid to __ even if others disagree.", correctWord: "speak her mind" },
                    { id: 99, idiom: "Hit the jackpot", emoji: "ðŸŽ°", meaning: "To have sudden great success, especially financially.", example: "Finding that antique at the market meant I __!", correctWord: "hit the jackpot" },
                    { id: 100, idiom: "The best of both worlds", emoji: "ðŸŒ", meaning: "A situation where you can enjoy the advantages of two very different things.", example: "Working remotely lets me have __.", correctWord: "the best of both worlds" }
                ];

                let quizQuestions = [];
                const QUIZ_SIZE = 20;
                let currentQuestionIndex = 0;
                let score = 0;

                function createFilename(idiomId) {
                    // FIX: Return the zero-padded ID number followed by .mp3
                    // Example: 1 -> "01.mp3", 10 -> "10.mp3", 100 -> "100.mp3"
                    const idString = idiomId.toString().padStart(2, '0');
                    return `${idString}.mp3`;
                }
                
                // --- AUDIO FEEDBACK FUNCTIONS ---
                function playCorrectSound() {
                    // Requires correct.mp3 in the same folder
                    const audio = new Audio('correct.mp3');
                    audio.play().catch(e => console.warn("Could not play correct.mp3:", e));
                }

                function playWrongSound() {
                    // Requires wrong.mp3 in the same folder
                    const audio = new Audio('wrong.mp3');
                    audio.play().catch(e => console.warn("Could not play wrong.mp3:", e));
                }

                function playAudio(idiomId, idiom) {
                    // This function is now called with the ID number
                    const filename = createFilename(idiomId);
                    console.log(`Attempting to play audio for ID ${idiomId} ("${idiom}"). File: ${filename}`);
                    
                    // Centralized audio stop logic
                    if (currentAudio && !currentAudio.paused) {
                        currentAudio.pause();
                        currentAudio.currentTime = 0;
                    }
                    
                    const newAudio = new Audio(filename);
                    currentAudio = newAudio;

                    newAudio.play().catch(e => {
                        console.error(`Error playing audio for ${idiom} (file: ${filename}). Ensure the file exists and is correctly named.`, e);
                        currentAudio = null; 
                    });
                }
                // --- END AUDIO FUNCTIONS ---

                function shuffleArray(array) {
                    for (let i = array.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [array[i], array[j]] = [array[j], array[i]];
                    }
                    return array;
                }

                function generateQuizQuestion(idiomData, allData) {
                    const allOthers = allData.filter(d => d.id !== idiomData.id);
                    const shuffledOthers = shuffleArray([...allOthers]);
                    const distractors = shuffledOthers.slice(0, 2);

                    let question = {};
                    question.correctId = idiomData.id;
                    
                    const questionType = Math.random() < 0.5 ? 'meaning' : 'sentence';

                    if (questionType === 'meaning') {
                        question.type = 'Meaning';
                        question.text = `What is the meaning of the idiom: "<span class="idiom-title">${idiomData.idiom}</span>"?`;
                        question.correctAnswer = idiomData.meaning;
                        question.choices = shuffleArray([
                            { text: idiomData.meaning, correct: true },
                            { text: distractors[0].meaning, correct: false },
                            { text: distractors[1].meaning, correct: false }
                        ]);
                    } else { // Sentence completion (choose the correct idiom)
                        question.type = 'Completion';
                        
                        // Prepare sentence for display with placeholder
                        const placeholderExample = idiomData.example.replace(new RegExp(`\\b${idiomData.correctWord.replace(/[-[\]/{}()*+?.\\^$|]/g, "\\$&")}\\b`, 'i'), '____');
                        
                        question.text = `Complete the sentence with the correct idiom: "${placeholderExample}"`;
                        question.correctAnswer = idiomData.idiom;
                        
                        question.choices = shuffleArray([
                            { text: idiomData.idiom, correct: true },
                            { text: distractors[0].idiom, correct: false },
                            { text: distractors[1].idiom, correct: false }
                        ]);
                    }
                    return question;
                }

                // --- FUNCTION TO RENDER LIST ON PAGE LOAD ---
                function renderIdiomList() {
                    const idiomListContainer = document.getElementById('idiom-list-content');
                    if (!idiomListContainer) return; // Safety check
                    
                    const listHTML = ALL_IDIOMS_DATA.map((d, index) => {
                        // Cycle through themes
                        const themeClass = CARD_THEMES[index % CARD_THEMES.length];
                        
                        // FIX: Replace the placeholder '__' with the correctly formatted idiom (using example-highlight class)
                        const highlightedExample = d.example.replace('__', `<strong class="example-highlight">${d.correctWord}</strong>`);
                        
                        return `
                            <div class="p-4 rounded-xl idiom-card ${themeClass}">
                                <div class="flex items-center mb-1">
                                    <span class="text-xl idiom-id mr-2">${d.id}.</span>
                                    <strong class="text-xl idiom-title">${d.idiom}</strong>
                                    <span class="text-2xl ml-2">${d.emoji}</span>
                                    <button class="speaker-btn text-3xl" onclick="playAudio(${d.id}, '${d.idiom}')" aria-label="Play audio for ${d.idiom}">
                                        &#128266;
                                    </button>
                                </div>
                                <p class="idiom-meaning mb-2">${d.meaning}</p>
                                <p class="handwriting">${highlightedExample}</p>
                            </div>
                        `;
                    }).join('');

                    idiomListContainer.innerHTML = listHTML;
                }
                // --- END LIST RENDER FUNCTION ---


                function startQuiz() {
                    // 1. Hide list and show quiz area
                    document.getElementById('idiom-list').classList.add('hidden');
                    document.getElementById('start-quiz-btn-container').classList.add('hidden');
                    document.getElementById('quiz-container').classList.remove('hidden');
                    document.getElementById('quiz-results').classList.add('hidden');
                    document.getElementById('quiz-area').classList.remove('hidden');

                    // 2. Reset state
                    currentQuestionIndex = 0;
                    score = 0;
                    quizQuestions = [];

                    // 3. Select 20 random idioms
                    const randomIdioms = shuffleArray([...ALL_IDIOMS_DATA]).slice(0, QUIZ_SIZE);

                    // 4. Generate questions
                    randomIdioms.forEach(idiom => {
                        quizQuestions.push(generateQuizQuestion(idiom, ALL_IDIOMS_DATA));
                    });
                    
                    renderQuestion();
                }

                function renderQuestion() {
                    if (currentQuestionIndex >= QUIZ_SIZE) {
                        showResults();
                        return;
                    }

                    const q = quizQuestions[currentQuestionIndex];
                    const quizArea = document.getElementById('quiz-area');
                    quizArea.innerHTML = `
                        <div class="p-6 bg-white rounded-lg shadow-xl border border-blue-300">
                            <p class="text-lg font-semibold text-gray-700 mb-2">
                                Question ${currentQuestionIndex + 1} of ${QUIZ_SIZE}
                            </p>
                            <div class="text-xl font-bold mb-6 text-blue-800">
                                ${q.text}
                            </div>
                            <form id="quiz-form" onsubmit="event.preventDefault(); checkAnswer();">
                                <div class="space-y-4">
                                    ${q.choices.map((choice, index) => `
                                        <label id="choice-${index}" data-correct="${choice.correct}" class="quiz-option block cursor-pointer p-4 bg-gray-50 rounded-lg border border-gray-300 transition duration-150">
                                            <input type="radio" name="answer" value="${choice.text}" class="mr-3 text-blue-600 focus:ring-blue-500">
                                            <span class="font-medium text-gray-800">${choice.text}</span>
                                        </label>
                                    `).join('')}
                                </div>
                                <button type="submit" id="submit-btn" class="w-full mt-8 px-6 py-3 bg-green-500 text-white font-bold rounded-lg shadow-md hover:bg-green-600 transition duration-200">
                                    Submit Answer
                                </button>
                                <button type="button" onclick="showIdiomList()" class="w-full mt-3 px-6 py-3 bg-red-500 text-white font-bold rounded-lg shadow-md hover:bg-red-600 transition duration-200">
                                    Leave the Test
                                </button>
                            </form>
                        </div>
                    `;
                }

                function displayFeedback(isCorrect, selectedElement, correctElement) {
                    const submitBtn = document.getElementById('submit-btn');
                    const form = document.getElementById('quiz-form');
                    
                    // Disable form elements
                    submitBtn.disabled = true;
                    form.querySelectorAll('input[type="radio"]').forEach(radio => radio.disabled = true);
                    
                    // Highlight selected/correct answers
                    if (isCorrect) {
                        selectedElement.classList.add('correct-answer');
                        playCorrectSound();
                    } else {
                        selectedElement.classList.add('incorrect-answer');
                        // Show the correct answer
                        correctElement.classList.add('correct-answer');
                        playWrongSound();
                    }

                    // Move to the next question after a delay
                    setTimeout(() => {
                        currentQuestionIndex++;
                        renderQuestion();
                    }, FEEDBACK_DELAY_MS);
                }

                function checkAnswer() {
                    const form = document.getElementById('quiz-form');
                    const selectedInput = form.querySelector('input[name="answer"]:checked');
                    
                    if (!selectedInput) {
                        alert("Please select an answer before submitting.");
                        return;
                    }
                    
                    const selectedElement = selectedInput.closest('.quiz-option');
                    const userAnswer = selectedInput.value;
                    
                    // Find the correct choice text
                    const q = quizQuestions[currentQuestionIndex];
                    const correctAnswerText = q.choices.find(c => c.correct).text;
                    
                    // Find the HTML element corresponding to the correct answer
                    let correctElement = null;
                    form.querySelectorAll('.quiz-option').forEach(element => {
                        if (element.querySelector('span').textContent === correctAnswerText) {
                            correctElement = element;
                        }
                    });

                    const isCorrect = (userAnswer === correctAnswerText);

                    // Increment score if correct
                    if (isCorrect) {
                        score++;
                    }

                    // Display visual feedback and pause before advancing
                    displayFeedback(isCorrect, selectedElement, correctElement);
                }

                function showResults() {
                    document.getElementById('quiz-area').classList.add('hidden');
                    const resultsDiv = document.getElementById('quiz-results');
                    resultsDiv.classList.remove('hidden');

                    resultsDiv.innerHTML = `
                        <div class="p-8 bg-green-50 rounded-xl shadow-2xl text-center">
                            <h2 class="text-3xl main-title text-green-700 mb-4">Quiz Complete!</h2>
                            <p class="text-4xl font-extrabold text-green-800 mb-6">
                                Your Score: ${score}/${QUIZ_SIZE}
                            </p>
                            <p class="text-lg text-gray-700 mb-8">
                                That's a strong effort! Review the idioms you missed to strengthen your IGCSE vocabulary.
                            </p>
                            <button onclick="startQuiz()" class="px-6 py-3 bg-blue-500 text-white font-bold rounded-lg shadow-md hover:bg-blue-600 transition duration-200 mr-4">
                                Try Again
                            </button>
                            <button onclick="showIdiomList()" class="px-6 py-3 bg-gray-400 text-white font-bold rounded-lg shadow-md hover:bg-gray-500 transition duration-200">
                                Back to Idioms List
                            </button>
                        </div>
                    `;
                }
                
                function showIdiomList() {
                    document.getElementById('quiz-container').classList.add('hidden');
                    document.getElementById('idiom-list').classList.remove('hidden');
                    document.getElementById('start-quiz-btn-container').classList.remove('hidden');
                }
            </script>

            <!-- Idioms List Section -->
            <div id="idiom-list">
                <div id="idiom-list-content" class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                    <!-- Idiom cards will be injected here by renderIdiomList() on load -->
                    <p class="text-center text-gray-500 col-span-full">Loading idioms...</p>
                </div>
            </div>

            <!-- Quiz Container (Hidden by default) -->
            <div id="quiz-container" class="mt-10 hidden">
                <div id="quiz-area">
                    <!-- Questions rendered here -->
                </div>
                <div id="quiz-results" class="hidden">
                    <!-- Results rendered here -->
                </div>
            </div>

            <!-- Start Test Button Container -->
            <div id="start-quiz-btn-container" class="text-center mt-10">
                <button onclick="startQuiz()" class="px-8 py-4 bg-blue-600 text-white font-extrabold rounded-xl shadow-lg hover:bg-blue-700 transition duration-200 text-lg">
                    Start Idioms Test (20 Questions)
                </button>
            </div>

            <footer class="text-center mt-10 pt-4 border-t-2 border-gray-200">
                <p class="text-gray-500 text-sm">Use these naturally in your Exercise 5 emails to demonstrate fluency and command of informal English vocabulary.</p>
            </footer>

        </div>
    </main>
</body>
</html>